openapi: 3.0.3
info:
  title: Artist Refresh API
  description: API contract for manually refreshing an artist's album collection from MusicBrainz
  version: 1.0.0

paths:
  /api/artists/{artistId}/refresh:
    post:
      summary: Refresh artist's album collection
      description: |
        Fetches the latest albums for an artist from MusicBrainz and adds any new albums
        not already in the collection. Updates the artist's updated_at timestamp to track
        when the refresh occurred.
      operationId: refreshArtist
      tags:
        - Artists
      parameters:
        - name: artistId
          in: path
          required: true
          description: The internal database ID of the artist to refresh
          schema:
            type: integer
            minimum: 1
          example: 42
      responses:
        '200':
          description: Refresh completed successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - albums_added
                  - updated_at
                properties:
                  success:
                    type: boolean
                    description: Indicates the refresh operation succeeded
                    example: true
                  albums_added:
                    type: integer
                    description: Number of new albums added to the collection
                    minimum: 0
                    example: 5
                  updated_at:
                    type: string
                    format: date-time
                    description: ISO 8601 timestamp of when the refresh completed
                    example: "2025-11-30T14:23:45.000Z"
                  message:
                    type: string
                    description: Optional message providing additional context
                    example: "No new albums found"
              examples:
                newAlbumsAdded:
                  summary: New albums were found and added
                  value:
                    success: true
                    albums_added: 5
                    updated_at: "2025-11-30T14:23:45.000Z"
                noNewAlbums:
                  summary: No new albums to add
                  value:
                    success: true
                    albums_added: 0
                    updated_at: "2025-11-30T14:23:45.000Z"
                    message: "No new albums found"
        '404':
          description: Artist not found in the collection
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "Artist not found"
                code: "ARTIST_NOT_FOUND"
                status: 404
        '409':
          description: Refresh already in progress for this artist
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "Refresh already in progress for this artist"
                code: "REFRESH_IN_PROGRESS"
                status: 409
        '503':
          description: MusicBrainz API unavailable or error occurred
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "Unable to connect to MusicBrainz service"
                code: "EXTERNAL_API_ERROR"
                status: 503

components:
  schemas:
    Error:
      type: object
      required:
        - error
        - code
        - status
      properties:
        error:
          type: string
          description: Human-readable error message
        code:
          type: string
          description: Machine-readable error code
        status:
          type: integer
          description: HTTP status code
        details:
          type: object
          description: Optional additional error details
          additionalProperties: true

  examples:
    SuccessfulRefresh:
      summary: Successfully refreshed artist with new albums
      value:
        success: true
        albums_added: 12
        updated_at: "2025-11-30T14:23:45.000Z"

    NoNewAlbumsFound:
      summary: Artist refreshed but no new albums available
      value:
        success: true
        albums_added: 0
        updated_at: "2025-11-30T14:23:45.000Z"
        message: "No new albums found"

tags:
  - name: Artists
    description: Artist management operations
